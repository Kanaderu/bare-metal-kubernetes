
config dnsmasq
	option domainneeded '1'
	option localise_queries '1'
	option rebind_protection '1'
	option rebind_localhost '1'
	option expandhosts '1'
	option authoritative '1'
	option readethers '1'
	option leasefile '/tmp/dhcp.leases'
	option resolvfile '/tmp/resolv.conf.d/resolv.conf.auto'
	option localservice '1'
	option ednspacket_max '1232'
	option local '/{{ lan_domain }}/'
	option domain '{{ lan_domain }}'
	list server '1.1.1.3'
	list server '1.0.0.3'

config dhcp 'lan'
	option interface 'lan'
	option leasetime '12h'
	option dhcpv6 'server'
	option dhcpv4 'server'
	option ra 'server'
	option start '100'
	option limit '150'
	list ra_flags 'managed-config'
	list ra_flags 'other-config'

config dhcp 'wan'
	option interface 'wan'
	option ignore '1'

config odhcpd 'odhcpd'
	option maindhcp '0'
	option leasefile '/tmp/hosts/odhcpd'
	option leasetrigger '/usr/sbin/odhcpd-update'
	option loglevel '4'

{% for h in lan_hosts %}
config host
  option dns '1'
  option name '{{ h.hostname }}'
  option mac '{{ h.mac }}'
  option ip '{{ h.ipv4 }}'
  {% if h.hostid is defined %}option hostid '{{ h.hostid }}'{% endif %}

  {% if h.duid is defined %}option duid '{{ h.duid }}'{% endif %}

{% endfor %}

{% for d in lan_domains %}
config domain
  option name '{{ d.domain }}'
  option ip '{{ d.ip_address }}'
{% endfor %}
