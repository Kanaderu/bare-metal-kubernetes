---
# tasks file for purelb

- name: get purelb install config
  uri:
    url: https://gitlab.com/purelb/purelb/-/raw/main/deployments/purelb-complete.yaml
    dest: /home/{{ ansible_user }}/purelb-complete.yaml

- name: create loadbalancer
  become: no
  command: kubectl create -f /home/{{ ansible_user }}/purelb-complete.yaml
  ignore_errors: yes

- name: create ip pool for load balancer
  template:
    src: {{ item }}.j2
    dest: /home/{{ ansible_user }}/{{ item }}
  loop: "{{ purelb_config_files }}"
- name: create ip address pool
  become: no
  command: kubectl create -f /home/{{ ansible_user }}/{{ item }}
  loop: "{{ purelb_config_files }}"
